<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>G-VET ASSET & iSTOR SYSTEM - Malaysian Government Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
            class="stat-card rounded-2xl shadow-xl p-6 card-hover animate-fade-in delay-1 border-l-4 border-blue-600"
    <style>
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .card-hover:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }
      .malaysia-flag {
        background: linear-gradient(
          90deg,
          #cc0001 0%,
          #cc0001 25%,
          #ffffff 25%,
          #ffffff 75%,
          #010066 75%,
          #010066 100%
        );
      }
      .animate-fade-in {
        animation: fadeIn 0.6s ease-in-out;
      }
      .animate-slide-up {
        animation: slideUp 0.5s ease-out;
      }
      .pulse-dot {
        animation: pulse 2s infinite;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(100px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.7;
          transform: scale(1.1);
        }
      }
      .modal-overlay {
        -webkit-backdrop-filter: blur(8px);
        backdrop-filter: blur(8px);
        animation: fadeIn 0.3s ease-out;
      }
      .modal-content {
        animation: slideUp 0.4s ease-out;
      }
      .stat-card {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95) 0%,
          rgba(255, 255, 255, 0.85) 100%
        );
      }

      /* Dark Mode Styles */
      body.dark-mode {
        background: #0f172a;
        color: #e2e8f0;
      }
      body.dark-mode .bg-gray-50 {
        background: #1e293b;
      }
      body.dark-mode .bg-white {
        background: #1e293b;
        color: #e2e8f0;
      }
      body.dark-mode .text-gray-900 {
        color: #f1f5f9;
      }
      body.dark-mode .text-gray-800 {
        color: #e2e8f0;
      }
      body.dark-mode .text-gray-700 {
        color: #cbd5e1;
      }
      body.dark-mode .text-gray-600 {
        color: #94a3b8;
      }
      body.dark-mode .stat-card {
        background: linear-gradient(
          135deg,
          rgba(30, 41, 59, 0.95) 0%,
          rgba(30, 41, 59, 0.85) 100%
        );
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Small animation delay helpers to avoid inline styles */
      .delay-1 { animation-delay: 0.1s !important; }
      .delay-2 { animation-delay: 0.2s !important; }
      .delay-3 { animation-delay: 0.3s !important; }
      .delay-4 { animation-delay: 0.4s !important; }
      .delay-5 { animation-delay: 0.5s !important; }
      .delay-6 { animation-delay: 0.6s !important; }
      .delay-7 { animation-delay: 0.7s !important; }
      .delay-8 { animation-delay: 0.8s !important; }
      }
      body.dark-mode .border-gray-200 {
        border-color: rgba(255, 255, 255, 0.1);
      }
      body.dark-mode .border-gray-100 {
        border-color: rgba(255, 255, 255, 0.05);
      }
      body.dark-mode .bg-gray-100 {
        background: #334155;
      }
      body.dark-mode .hover\:bg-gray-100:hover {
        background: #334155;
      }
      body.dark-mode .bg-gradient-to-br.from-blue-50 {
        background: linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.2) 0%,
          rgba(59, 130, 246, 0.1) 100%
        );
      }
      body.dark-mode .bg-gradient-to-br.from-green-50 {
        background: linear-gradient(
          135deg,
          rgba(34, 197, 94, 0.2) 0%,
          rgba(34, 197, 94, 0.1) 100%
        );
      }
      body.dark-mode .bg-gradient-to-br.from-purple-50 {
        background: linear-gradient(
          135deg,
          rgba(168, 85, 247, 0.2) 0%,
          rgba(168, 85, 247, 0.1) 100%
        );
      }
      body.dark-mode .bg-gradient-to-br.from-orange-50 {
        background: linear-gradient(
          135deg,
          rgba(249, 115, 22, 0.2) 0%,
          rgba(249, 115, 22, 0.1) 100%
        );
      }
      body.dark-mode .bg-gradient-to-r.from-blue-50 {
        background: linear-gradient(
          90deg,
          rgba(59, 130, 246, 0.2),
          rgba(59, 130, 246, 0.1)
        );
      }
      body.dark-mode .bg-gradient-to-r.from-green-50 {
        background: linear-gradient(
          90deg,
          rgba(34, 197, 94, 0.2),
          rgba(34, 197, 94, 0.1)
        );
      }
      body.dark-mode .bg-gray-50 {
        background: #1e293b;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Security Notice Modal -->
    <div
      id="security-modal"
      class="fixed inset-0 bg-black/90 modal-overlay flex items-center justify-center p-4 z-50"
    >
      <div
        class="bg-white rounded-2xl max-w-2xl w-full p-8 border-4 border-red-500 shadow-2xl modal-content"
      >
        <div class="text-center mb-6">
          <div
            class="mx-auto mb-4 w-20 h-20 rounded-full flex items-center justify-center"
          >
            <img
              src="/static/images/G-Vet-logo.png"
              alt="G-VET Logo"
              class="w-20 h-20 object-contain"
            />
          </div>
          <h2 class="text-2xl font-bold text-red-800 mb-2">
            üèõÔ∏è NOTIS KESELAMATAN SISTEM KERAJAAN
          </h2>
          <p class="text-sm text-gray-600">
            Malaysian Government Official System
          </p>
        </div>
        <div class="space-y-4 text-sm">
          <div
            class="bg-red-50 p-6 rounded-xl border-2 border-red-200 shadow-inner"
          >
            <p class="font-bold text-red-800 mb-3 flex items-center">
              <i class="fas fa-exclamation-triangle mr-2"></i>
              AMARAN RASMI (OFFICIAL WARNING):
            </p>
            <ul class="text-red-700 space-y-2 text-sm">
              <li class="flex items-start">
                <i class="fas fa-check-circle mr-2 mt-1"></i>
                <span>Sistem ini adalah hak milik Kerajaan Malaysia</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle mr-2 mt-1"></i>
                <span>Akses tanpa kebenaran adalah DILARANG</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle mr-2 mt-1"></i>
                <span>Semua aktiviti dipantau dan direkod 24/7</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check-circle mr-2 mt-1"></i>
                <span>Pelanggaran tertakluk kepada tindakan undang-undang</span>
              </li>
            </ul>
          </div>
          <div
            class="bg-blue-50 p-6 rounded-xl border-2 border-blue-200 shadow-inner"
          >
            <p class="font-bold text-blue-800 mb-3 flex items-center">
              <i class="fas fa-gavel mr-2"></i>
              PEMATUHAN UNDANG-UNDANG (LEGAL COMPLIANCE):
            </p>
            <ul class="text-blue-700 space-y-2 text-sm">
              <li class="flex items-start">
                <i class="fas fa-balance-scale mr-2 mt-1"></i>
                <span>Akta Rahsia Rasmi 1972</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-balance-scale mr-2 mt-1"></i>
                <span>Peraturan Perbendaharaan Malaysia</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-balance-scale mr-2 mt-1"></i>
                <span>Garis Panduan Keselamatan ICT Sektor Awam</span>
              </li>
            </ul>
          </div>
          <button
            onclick="acceptSecurityNotice()"
            class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105"
          >
            <i class="fas fa-check-double mr-2"></i>
            Saya Faham dan Bersetuju (I Understand and Agree)
          </button>
        </div>
      </div>
    </div>

    <!-- Login Section -->
    <div
      id="login-section"
      class="min-h-screen gradient-bg flex items-center justify-center p-4 hidden"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slide-up"
      >
        <div class="text-center mb-8">
          <div
            class="mx-auto mb-4 w-24 h-24 bg-gradient-to-br from-blue-600 to-green-600 rounded-full flex items-center justify-center shadow-lg animate-pulse"
          >
            <i class="fas fa-building text-white text-3xl"></i>
          </div>
          <h1
            class="text-3xl font-bold bg-gradient-to-r from-blue-800 to-green-700 bg-clip-text text-transparent mb-2"
          >
            G-VET ASSET & iSTOR SYSTEM
          </h1>
          <div class="text-sm text-gray-700 space-y-1">
            <div class="font-bold">üèõÔ∏è SISTEM RASMI KERAJAAN MALAYSIA</div>
            <div class="text-xs text-blue-700 font-medium">
              KEW.PA ‚Ä¢ KEW.PS ‚Ä¢ KEW.AH
            </div>
            <div class="text-xs text-green-700">
              Jabatan Perkhidmatan Veterinar Negeri Perak
            </div>
          </div>
        </div>

        <form id="login-form" class="space-y-5">
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-user mr-2"></i>Username Pengguna
            </label>
            <input
              type="text"
              id="username"
              required
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
              placeholder="Masukkan nama pengguna anda"
            />
          </div>
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-lock mr-2"></i>Kata Laluan
            </label>
            <input
              type="password"
              id="password"
              required
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
              placeholder="Masukkan kata laluan anda"
            />
          </div>
          <div
            id="login-error"
            class="hidden bg-red-50 border-2 border-red-200 text-red-700 px-4 py-3 rounded-lg"
          >
            <i class="fas fa-exclamation-circle mr-2"></i>
            <span id="login-error-text"></span>
          </div>

          <!-- Remember Me Checkbox -->
          <div class="flex items-center">
            <input
              type="checkbox"
              id="remember-me"
              class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
            />
            <label
              for="remember-me"
              class="ml-2 text-sm font-medium text-gray-700"
            >
              <i class="fas fa-save mr-1"></i>Ingat Log Masuk Saya (Remember Me)
            </label>
          </div>

          <!-- Simple CAPTCHA -->
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-shield-alt mr-2"></i>Pengesahan Keselamatan
              (Security Verification)
            </label>
            <div class="flex items-center space-x-3">
              <div
                class="flex-1 bg-gray-100 border-2 border-gray-300 rounded-lg p-3 text-center"
              >
                <span
                  id="captcha-question"
                  class="text-lg font-bold text-gray-800"
                ></span>
              </div>
              <input
                type="text"
                id="captcha-answer"
                required
                class="w-24 px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-center"
                placeholder="?"
                autocomplete="off"
              />
              <button
                type="button"
                onclick="generateCaptcha()"
                class="bg-gray-200 hover:bg-gray-300 p-3 rounded-lg transition-all"
                title="Refresh CAPTCHA"
              >
                <i class="fas fa-sync-alt text-gray-600"></i>
              </button>
            </div>
          </div>

          <button
            type="submit"
            class="w-full bg-gradient-to-r from-green-600 to-blue-700 hover:from-green-700 hover:to-blue-800 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all transform hover:scale-105"
          >
            <i class="fas fa-sign-in-alt mr-2"></i> Log Masuk Sekarang
          </button>
        </form>

        <!-- Demo Accounts -->
        <div
          class="mt-6 p-4 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl border-2 border-gray-200"
        >
          <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center">
            <i class="fas fa-database text-blue-600 mr-2"></i> Akaun Demo Rasmi
          </h3>
          <div class="grid grid-cols-2 gap-3 text-xs">
            <button
              onclick="fillDemo('admin', 'admin123')"
              class="p-3 bg-gradient-to-br from-red-50 to-red-100 border-2 border-red-300 rounded-lg hover:shadow-lg transition-all transform hover:scale-105"
            >
              <div class="font-bold text-red-700">üë®‚Äçüíº Admin</div>
              <div class="text-gray-600 text-xs">System Administrator</div>
            </button>
            <button
              onclick="fillDemo('manager', 'manager123')"
              class="p-3 bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300 rounded-lg hover:shadow-lg transition-all transform hover:scale-105"
            >
              <div class="font-bold text-blue-700">üëî Manager</div>
              <div class="text-gray-600 text-xs">Department Manager</div>
            </button>
            <button
              onclick="fillDemo('staff', 'staff123')"
              class="p-3 bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-300 rounded-lg hover:shadow-lg transition-all transform hover:scale-105"
            >
              <div class="font-bold text-green-700">üë§ Staff</div>
              <div class="text-gray-600 text-xs">Asset Staff</div>
            </button>
            <button
              onclick="fillDemo('visitor', 'visitor123')"
              class="p-3 bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-300 rounded-lg hover:shadow-lg transition-all transform hover:scale-105"
            >
              <div class="font-bold text-gray-700">üëÅÔ∏è Visitor</div>
              <div class="text-gray-600 text-xs">Guest User</div>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Dashboard -->
    <div id="main-dashboard" class="min-h-screen">
      <!-- Enhanced Header -->
      <header class="gradient-bg text-white shadow-2xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center py-4">
            <div class="flex items-center space-x-4">
              <div
                class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-lg p-1"
              >
                <img
                  src="/static/images/veterinar-logo.png"
                  alt="Veterinar Logo"
                  class="w-full h-full object-contain"
                />
              </div>
              <div>
                <h1 class="text-2xl font-bold">G-VET ASSET & iSTOR SYSTEM</h1>
                <p class="text-blue-100 text-sm">KEW.PA ‚Ä¢ KEW.PS ‚Ä¢ KEW.AH</p>
              </div>
              <div
                class="hidden md:block w-6 h-8 malaysia-flag rounded shadow-md"
              ></div>
            </div>
            <div class="flex items-center space-x-4">
              <div class="bg-white/20 rounded-lg px-4 py-2 backdrop-blur-sm">
                <span class="text-sm">Status: </span>
                <span class="font-bold pulse-dot">üü¢ Operational</span>
              </div>
              <button
                onclick="toggleTheme()"
                class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg shadow-lg transition-all transform hover:scale-105"
                title="Toggle Dark/Light Mode"
              >
                <i id="theme-icon" class="fas fa-moon"></i>
              </button>
              <div
                class="flex items-center space-x-2 bg-white/10 rounded-lg px-4 py-2"
              >
                <i class="fas fa-user-circle text-xl"></i>
                <span id="user-role" class="text-sm font-medium"></span>
              </div>
              <button
                onclick="logout()"
                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow-lg transition-all transform hover:scale-105"
              >
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- System Status Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div
            class="stat-card rounded-2xl shadow-xl p-6 card-hover animate-fade-in border-l-4 border-blue-600"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-600 text-sm font-medium">Total Assets</p>
                <p
                  class="text-3xl font-bold text-blue-600 mt-1"
                  id="total-assets"
                >
                  0
                </p>
                <p class="text-xs text-gray-500 mt-1">KEW.PA Framework</p>
              </div>
              <div
                class="w-14 h-14 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center shadow-lg"
              >
                <i class="fas fa-desktop text-white text-xl"></i>
              </div>
            </div>
          </div>

          <div
            class="stat-card rounded-2xl shadow-xl p-6 card-hover animate-fade-in delay-1 border-l-4 border-green-600"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-600 text-sm font-medium">Inventory Items</p>
                <p
                  class="text-3xl font-bold text-green-600 mt-1"
                  id="total-inventory"
                >
                  0
                </p>
                <p class="text-xs text-gray-500 mt-1">KEW.PS Framework</p>
              </div>
              <div
                class="w-14 h-14 bg-gradient-to-br from-green-400 to-green-600 rounded-xl flex items-center justify-center shadow-lg"
              >
                <i class="fas fa-boxes text-white text-xl"></i>
              </div>
            </div>
          </div>

          <div
            class="stat-card rounded-2xl shadow-xl p-6 card-hover animate-fade-in delay-2 border-l-4 border-yellow-600"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-600 text-sm font-medium">
                  Low Stock Alerts
                </p>
                <p
                  class="text-3xl font-bold text-yellow-600 mt-1"
                  id="low-stock"
                >
                  0
                </p>
                <p class="text-xs text-gray-500 mt-1">Need Attention</p>
              </div>
              <div
                class="w-14 h-14 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-xl flex items-center justify-center shadow-lg"
              >
                <i class="fas fa-exclamation-triangle text-white text-xl"></i>
              </div>
            </div>
          </div>

          <div
            class="stat-card rounded-2xl shadow-xl p-6 card-hover animate-fade-in delay-3 border-l-4 border-purple-600"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-600 text-sm font-medium">Active Users</p>
                <p
                  class="text-3xl font-bold text-purple-600 mt-1"
                  id="active-users"
                >
                  0
                </p>
                <p class="text-xs text-gray-500 mt-1">Currently Online</p>
              </div>
              <div
                class="w-14 h-14 bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl flex items-center justify-center shadow-lg"
              >
                <i class="fas fa-users text-white text-xl"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div
          class="bg-white rounded-2xl shadow-xl p-8 mb-8 animate-fade-in delay-4"
        >
          <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
            <i class="fas fa-bolt text-yellow-500 mr-3"></i>
            Quick Actions - All Modules
          </h2>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            <!-- KEW.PA Asset Modules -->
            <button
              onclick="openModule('kewpa-dashboard')"
              class="p-6 bg-gradient-to-br from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 rounded-xl transition-all card-hover border-2 border-blue-200"
            >
              <i class="fas fa-tachometer-alt text-blue-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">KEW.PA</p>
              <p class="text-xs text-gray-600">Dashboard</p>
            </button>
            <button
              onclick="openModule('asset-registration')"
              class="p-6 bg-gradient-to-br from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 rounded-xl transition-all card-hover border-2 border-blue-200"
            >
              <i class="fas fa-desktop text-blue-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Asset Reg</p>
              <p class="text-xs text-gray-600">KEW.PA-3/4</p>
            </button>
            <button
              onclick="openModule('asset-receipt')"
              class="p-6 bg-gradient-to-br from-cyan-50 to-cyan-100 hover:from-cyan-100 hover:to-cyan-200 rounded-xl transition-all card-hover border-2 border-cyan-200"
            >
              <i class="fas fa-inbox text-cyan-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Receipt</p>
              <p class="text-xs text-gray-600">KEW.PA-1/2</p>
            </button>
            <button
              onclick="openModule('asset-movement')"
              class="p-6 bg-gradient-to-br from-indigo-50 to-indigo-100 hover:from-indigo-100 hover:to-indigo-200 rounded-xl transition-all card-hover border-2 border-indigo-200"
            >
              <i class="fas fa-exchange-alt text-indigo-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Movement</p>
              <p class="text-xs text-gray-600">KEW.PA-9/10</p>
            </button>
            <button
              onclick="openModule('asset-inspection')"
              class="p-6 bg-gradient-to-br from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 rounded-xl transition-all card-hover border-2 border-purple-200"
            >
              <i class="fas fa-search text-purple-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Inspection</p>
              <p class="text-xs text-gray-600">KEW.PA-11/12</p>
            </button>
            <button
              onclick="openModule('asset-maintenance')"
              class="p-6 bg-gradient-to-br from-pink-50 to-pink-100 hover:from-pink-100 hover:to-pink-200 rounded-xl transition-all card-hover border-2 border-pink-200"
            >
              <i class="fas fa-wrench text-pink-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Maintenance</p>
              <p class="text-xs text-gray-600">KEW.PA-13/16</p>
            </button>

            <!-- KEW.PS Store Modules -->
            <button
              onclick="openModule('kewps-dashboard')"
              class="p-6 bg-gradient-to-br from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 rounded-xl transition-all card-hover border-2 border-green-200"
            >
              <i class="fas fa-tachometer-alt text-green-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">KEW.PS</p>
              <p class="text-xs text-gray-600">Dashboard</p>
            </button>
            <button
              onclick="openModule('store-receipt')"
              class="p-6 bg-gradient-to-br from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 rounded-xl transition-all card-hover border-2 border-green-200"
            >
              <i class="fas fa-truck-loading text-green-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Store Receipt</p>
              <p class="text-xs text-gray-600">KEW.PS-1/2</p>
            </button>
            <button
              onclick="openModule('stock-control')"
              class="p-6 bg-gradient-to-br from-teal-50 to-teal-100 hover:from-teal-100 hover:to-teal-200 rounded-xl transition-all card-hover border-2 border-teal-200"
            >
              <i class="fas fa-boxes text-teal-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Stock Control</p>
              <p class="text-xs text-gray-600">KEW.PS-3/4</p>
            </button>
            <button
              onclick="openModule('store-issuance')"
              class="p-6 bg-gradient-to-br from-emerald-50 to-emerald-100 hover:from-emerald-100 hover:to-emerald-200 rounded-xl transition-all card-hover border-2 border-emerald-200"
            >
              <i class="fas fa-dolly text-emerald-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Issuance</p>
              <p class="text-xs text-gray-600">KEW.PS-7/9</p>
            </button>
            <button
              onclick="openModule('store-verification')"
              class="p-6 bg-gradient-to-br from-lime-50 to-lime-100 hover:from-lime-100 hover:to-lime-200 rounded-xl transition-all card-hover border-2 border-lime-200"
            >
              <i class="fas fa-clipboard-check text-lime-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Verification</p>
              <p class="text-xs text-gray-600">KEW.PS-10/12</p>
            </button>
            <button
              onclick="openModule('inventory-management')"
              class="p-6 bg-gradient-to-br from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 rounded-xl transition-all card-hover border-2 border-green-200"
            >
              <i class="fas fa-warehouse text-green-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Inventory</p>
              <p class="text-xs text-gray-600">Full System</p>
            </button>

            <!-- KEW.AH Live Assets -->
            <button
              onclick="openModule('kewah-dashboard')"
              class="p-6 bg-gradient-to-br from-amber-50 to-amber-100 hover:from-amber-100 hover:to-amber-200 rounded-xl transition-all card-hover border-2 border-amber-200"
            >
              <i class="fas fa-paw text-amber-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">KEW.AH</p>
              <p class="text-xs text-gray-600">Live Assets</p>
            </button>
            <button
              onclick="openModule('livestock-register')"
              class="p-6 bg-gradient-to-br from-yellow-50 to-yellow-100 hover:from-yellow-100 hover:to-yellow-200 rounded-xl transition-all card-hover border-2 border-yellow-200"
            >
              <i class="fas fa-horse text-yellow-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Livestock</p>
              <p class="text-xs text-gray-600">KEW.AH-2</p>
            </button>
            <button
              onclick="openModule('veterinary-care')"
              class="p-6 bg-gradient-to-br from-orange-50 to-orange-100 hover:from-orange-100 hover:to-orange-200 rounded-xl transition-all card-hover border-2 border-orange-200"
            >
              <i class="fas fa-heartbeat text-orange-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Vet Care</p>
              <p class="text-xs text-gray-600">KEW.AH-3/4</p>
            </button>

            <!-- Analytics & Reports -->
            <button
              onclick="openModule('analytics')"
              class="p-6 bg-gradient-to-br from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 rounded-xl transition-all card-hover border-2 border-purple-200"
            >
              <i class="fas fa-chart-line text-purple-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Analytics</p>
              <p class="text-xs text-gray-600">All Reports</p>
            </button>
            <button
              onclick="openModule('advanced-search')"
              class="p-6 bg-gradient-to-br from-violet-50 to-violet-100 hover:from-violet-100 hover:to-violet-200 rounded-xl transition-all card-hover border-2 border-violet-200"
            >
              <i class="fas fa-search-plus text-violet-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Search</p>
              <p class="text-xs text-gray-600">Advanced</p>
            </button>

            <!-- Tools & Integration -->
            <button
              onclick="openModule('qrcode')"
              class="p-6 bg-gradient-to-br from-indigo-50 to-indigo-100 hover:from-indigo-100 hover:to-indigo-200 rounded-xl transition-all card-hover border-2 border-indigo-200"
            >
              <i class="fas fa-qrcode text-indigo-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">QR Code</p>
              <p class="text-xs text-gray-600">Scanner</p>
            </button>
            <button
              onclick="openModule('forms')"
              class="p-6 bg-gradient-to-br from-orange-50 to-orange-100 hover:from-orange-100 hover:to-orange-200 rounded-xl transition-all card-hover border-2 border-orange-200"
            >
              <i class="fas fa-file-alt text-orange-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Forms</p>
              <p class="text-xs text-gray-600">Templates</p>
            </button>
            <button
              onclick="openModule('procurement')"
              class="p-6 bg-gradient-to-br from-sky-50 to-sky-100 hover:from-sky-100 hover:to-sky-200 rounded-xl transition-all card-hover border-2 border-sky-200"
            >
              <i class="fas fa-shopping-cart text-sky-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Procurement</p>
              <p class="text-xs text-gray-600">Management</p>
            </button>
            <button
              onclick="openModule('suppliers')"
              class="p-6 bg-gradient-to-br from-rose-50 to-rose-100 hover:from-rose-100 hover:to-rose-200 rounded-xl transition-all card-hover border-2 border-rose-200"
            >
              <i class="fas fa-building text-rose-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Suppliers</p>
              <p class="text-xs text-gray-600">Database</p>
            </button>

            <!-- Administration -->
            <button
              onclick="openModule('admin')"
              class="p-6 bg-gradient-to-br from-red-50 to-red-100 hover:from-red-100 hover:to-red-200 rounded-xl transition-all card-hover border-2 border-red-200"
            >
              <i class="fas fa-cog text-red-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">Admin</p>
              <p class="text-xs text-gray-600">Settings</p>
            </button>
            <button
              onclick="openModule('it-admin')"
              class="p-6 bg-gradient-to-br from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 rounded-xl transition-all card-hover border-2 border-gray-300"
            >
              <i class="fas fa-server text-gray-600 text-3xl mb-3"></i>
              <p class="text-sm font-bold text-gray-800">IT Admin</p>
              <p class="text-xs text-gray-600">System</p>
            </button>
          </div>
        </div>

        <!-- Integration & Activities -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
          <div
            class="bg-white rounded-2xl shadow-xl p-8 animate-fade-in delay-5"
          >
            <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
              <i class="fas fa-plug text-green-500 mr-3"></i>
              System Integration Status
            </h2>
            <div class="space-y-4">
              <div
                class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-xl border-2 border-green-200"
              >
                <div class="flex items-center">
                  <i
                    class="fas fa-check-circle text-green-600 mr-3 text-xl"
                  ></i>
                  <span class="text-sm font-bold text-gray-800"
                    >Info-T Aset</span
                  >
                </div>
                <span
                  class="text-xs bg-green-600 text-white px-3 py-1 rounded-full font-bold"
                  >Connected</span
                >
              </div>
              <div
                class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-xl border-2 border-green-200"
              >
                <div class="flex items-center">
                  <i
                    class="fas fa-check-circle text-green-600 mr-3 text-xl"
                  ></i>
                  <span class="text-sm font-bold text-gray-800"
                    >iStor System</span
                  >
                </div>
                <span
                  class="text-xs bg-green-600 text-white px-3 py-1 rounded-full font-bold"
                  >Connected</span
                >
              </div>
              <div
                class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border-2 border-blue-200"
              >
                <div class="flex items-center">
                  <i class="fas fa-check-circle text-blue-600 mr-3 text-xl"></i>
                  <span class="text-sm font-bold text-gray-800"
                    >KEW.PA Framework</span
                  >
                </div>
                <span
                  class="text-xs bg-blue-600 text-white px-3 py-1 rounded-full font-bold"
                  >Active</span
                >
              </div>
              <div
                class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border-2 border-blue-200"
              >
                <div class="flex items-center">
                  <i class="fas fa-check-circle text-blue-600 mr-3 text-xl"></i>
                  <span class="text-sm font-bold text-gray-800"
                    >KEW.PS Framework</span
                  >
                </div>
                <span
                  class="text-xs bg-blue-600 text-white px-3 py-1 rounded-full font-bold"
                  >Active</span
                >
              </div>
            </div>
            <button
              onclick="verifySystem()"
              class="w-full mt-6 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-4 py-3 rounded-xl shadow-lg transition-all transform hover:scale-105 font-bold"
            >
              <i class="fas fa-shield-alt mr-2"></i>Verify System Status
            </button>
          </div>

          <div
            class="bg-white rounded-2xl shadow-xl p-8 animate-fade-in delay-6"
          >
            <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
              <i class="fas fa-history text-purple-500 mr-3"></i>
              Recent Activities
            </h2>
            <div id="recent-activities" class="space-y-3">
              <!-- Activities will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Module Categories -->
        <div
          class="bg-white rounded-2xl shadow-xl p-8 mb-8 animate-fade-in delay-7"
        >
          <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
            <i class="fas fa-th-large text-purple-500 mr-3"></i>
            Module Categories
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- KEW.PA Modules -->
            <div
              class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl border-2 border-blue-200 card-hover"
            >
              <h3 class="font-bold text-blue-900 mb-4 flex items-center">
                <i class="fas fa-desktop mr-2"></i>
                KEW.PA Asset Management
              </h3>
              <ul class="space-y-2 text-sm text-blue-800">
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-blue-600"></i>Asset
                  Registration (PA-3/4)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-blue-600"></i>Receipt
                  & Rejection (PA-1/2)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-blue-600"></i>Movement
                  & Transfer (PA-9/10)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-blue-600"></i
                  >Inspection (PA-11/12)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-blue-600"></i
                  >Maintenance (PA-13/16)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-blue-600"></i>Disposal
                  (PA-17/23)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-blue-600"></i>36 Forms
                  Available
                </li>
              </ul>
              <button
                onclick="openModule('kewpa-dashboard')"
                class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition-all"
              >
                Access KEW.PA
              </button>
            </div>

            <!-- KEW.PS Modules -->
            <div
              class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl border-2 border-green-200 card-hover"
            >
              <h3 class="font-bold text-green-900 mb-4 flex items-center">
                <i class="fas fa-warehouse mr-2"></i>
                KEW.PS Store Management
              </h3>
              <ul class="space-y-2 text-sm text-green-800">
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-green-600"></i>Store
                  Receipt (PS-1/2)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-green-600"></i>Stock
                  Control (PS-3/4)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-green-600"></i
                  >Issuance (PS-7/9)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-green-600"></i
                  >Verification (PS-10/12)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-green-600"></i
                  >Disposal (PS-15/19)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-green-600"></i>ABC
                  Analysis (PS-5)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-green-600"></i>36
                  Forms Available
                </li>
              </ul>
              <button
                onclick="openModule('kewps-dashboard')"
                class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition-all"
              >
                Access KEW.PS
              </button>
            </div>

            <!-- KEW.AH Modules -->
            <div
              class="bg-gradient-to-br from-amber-50 to-amber-100 p-6 rounded-xl border-2 border-amber-200 card-hover"
            >
              <h3 class="font-bold text-amber-900 mb-4 flex items-center">
                <i class="fas fa-paw mr-2"></i>
                KEW.AH Live Assets
              </h3>
              <ul class="space-y-2 text-sm text-amber-800">
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-amber-600"></i>Live
                  Asset Register (AH-2)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-amber-600"></i
                  >Veterinary Care (AH-3/4)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-amber-600"></i
                  >Breeding Records (AH-5)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-amber-600"></i
                  >Mortality Reports (AH-6)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-amber-600"></i
                  >Transfer Management (AH-7)
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-amber-600"></i>Health
                  Monitoring
                </li>
                <li class="flex items-center">
                  <i class="fas fa-check-circle mr-2 text-amber-600"></i>8 Forms
                  Available
                </li>
              </ul>
              <button
                onclick="openModule('kewah-dashboard')"
                class="w-full mt-4 bg-amber-600 hover:bg-amber-700 text-white py-2 rounded-lg transition-all"
              >
                Access KEW.AH
              </button>
            </div>
          </div>
        </div>

        <!-- Compliance Dashboard -->
        <div
          class="bg-white rounded-2xl shadow-xl p-8 animate-fade-in delay-8"
        >
          <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
            <i class="fas fa-clipboard-check text-blue-500 mr-3"></i>
            Government Compliance Dashboard
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
            <div
              class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl border-2 border-blue-200 card-hover"
            >
              <div class="flex items-center mb-3">
                <i class="fas fa-clipboard-list text-blue-600 mr-3 text-xl"></i>
                <h3 class="font-bold text-blue-800">KEW.PA Forms</h3>
              </div>
              <p class="text-3xl font-bold text-blue-900">36</p>
              <p class="text-xs text-blue-700 mt-2">Asset Templates</p>
            </div>
            <div
              class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl border-2 border-green-200 card-hover"
            >
              <div class="flex items-center mb-3">
                <i class="fas fa-store text-green-600 mr-3 text-xl"></i>
                <h3 class="font-bold text-green-800">KEW.PS Forms</h3>
              </div>
              <p class="text-3xl font-bold text-green-900">36</p>
              <p class="text-xs text-green-700 mt-2">Store Templates</p>
            </div>
            <div
              class="bg-gradient-to-br from-amber-50 to-amber-100 p-6 rounded-xl border-2 border-amber-200 card-hover"
            >
              <div class="flex items-center mb-3">
                <i class="fas fa-paw text-amber-600 mr-3 text-xl"></i>
                <h3 class="font-bold text-amber-800">KEW.AH Forms</h3>
              </div>
              <p class="text-3xl font-bold text-amber-900">8</p>
              <p class="text-xs text-amber-700 mt-2">Live Asset Forms</p>
            </div>
            <div
              class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-xl border-2 border-purple-200 card-hover"
            >
              <div class="flex items-center mb-3">
                <i class="fas fa-database text-purple-600 mr-3 text-xl"></i>
                <h3 class="font-bold text-purple-800">Total Modules</h3>
              </div>
              <p class="text-3xl font-bold text-purple-900">24+</p>
              <p class="text-xs text-purple-700 mt-2">Active Systems</p>
            </div>
            <div
              class="bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-xl border-2 border-orange-200 card-hover"
            >
              <div class="flex items-center mb-3">
                <i class="fas fa-chart-pie text-orange-600 mr-3 text-xl"></i>
                <h3 class="font-bold text-orange-800">Integration</h3>
              </div>
              <p class="text-3xl font-bold text-orange-900">100%</p>
              <p class="text-xs text-orange-700 mt-2">Connected</p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- JavaScript -->
    <script src="/static/js/premium.js"></script>
    <script>
      let isLoggedIn = false;
      let currentUser = null;
      let isDarkMode = false;
      let socket = null;

      // Load theme preference from localStorage
      if (localStorage.getItem("theme") === "dark") {
        isDarkMode = true;
        document.body.classList.add("dark-mode");
        if (document.getElementById("theme-icon")) {
          document.getElementById("theme-icon").className = "fas fa-sun";
        }
      }

      function toggleTheme() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle("dark-mode");
        const themeIcon = document.getElementById("theme-icon");

        if (isDarkMode) {
          themeIcon.className = "fas fa-sun";
          localStorage.setItem("theme", "dark");
        } else {
          themeIcon.className = "fas fa-moon";
          localStorage.setItem("theme", "light");
        }
      }

      const demoUsers = {
        admin: { password: "admin123", role: "System Administrator" },
        manager: { password: "manager123", role: "Department Manager" },
        staff: { password: "staff123", role: "Asset Staff" },
        visitor: { password: "visitor123", role: "Guest User" },
      };

      function acceptSecurityNotice() {
        document.getElementById("security-modal").style.display = "none";
        document.getElementById("login-section").style.display = "flex";
      }

      function fillDemo(username, password) {
        document.getElementById("username").value = username;
        document.getElementById("password").value = password;
      }

      function showLoginError(message) {
        const errorDiv = document.getElementById("login-error");
        const errorText = document.getElementById("login-error-text");
        errorText.textContent = message;
        errorDiv.classList.remove("hidden");
      }

      function hideLoginError() {
        document.getElementById("login-error").classList.add("hidden");
      }

      async function login(username, password) {
        try {
          // Try API authentication first
          const response = await fetch(
            `${window.GVET.config.apiBaseURL}/auth/login`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ username, password }),
            },
          );

          if (response.ok) {
            const data = await response.json();

            // Store tokens
            localStorage.setItem("accessToken", data.accessToken);
            localStorage.setItem("refreshToken", data.refreshToken);
            localStorage.setItem("currentUser", JSON.stringify(data.user));

            isLoggedIn = true;
            currentUser = data.user;

            document.getElementById("login-section").style.display = "none";
            document.getElementById("main-dashboard").style.display = "block";
            document.getElementById("user-role").textContent =
              currentUser.fullName || currentUser.role;

            // Update theme icon after dashboard loads
            const themeIcon = document.getElementById("theme-icon");
            if (themeIcon && isDarkMode) {
              themeIcon.className = "fas fa-sun";
            }

            // Initialize WebSocket
            initWebSocket();

            // Load real dashboard data
            await loadDashboardData();

            window.GVET.notifications.show(
              "Login successful! Welcome " + currentUser.username,
              "success",
            );
            return true;
          }
        } catch (error) {
          console.warn("API login failed, trying demo mode:", error);
        }

        // Fallback to demo mode
        if (demoUsers[username] && demoUsers[username].password === password) {
          isLoggedIn = true;
          currentUser = {
            username,
            role: demoUsers[username].role,
            fullName: demoUsers[username].role,
          };

          document.getElementById("login-section").style.display = "none";
          document.getElementById("main-dashboard").style.display = "block";
          document.getElementById("user-role").textContent = currentUser.role;

          const themeIcon = document.getElementById("theme-icon");
          if (themeIcon && isDarkMode) {
            themeIcon.className = "fas fa-sun";
          }

          loadDashboardData();
          window.GVET.notifications.show("Demo mode: " + username, "info");
          return true;
        }

        return false;
      }

      async function logout() {
        if (confirm("Are you sure you want to logout?")) {
          try {
            const token = localStorage.getItem("accessToken");
            if (token) {
              await fetch(`${window.GVET.config.apiBaseURL}/auth/logout`, {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              });
            }
          } catch (error) {
            console.warn("Logout API error:", error);
          }

          // Disconnect WebSocket
          if (socket) {
            socket.disconnect();
            socket = null;
          }

          // Clear local storage
          localStorage.removeItem("accessToken");
          localStorage.removeItem("refreshToken");
          localStorage.removeItem("currentUser");

          isLoggedIn = false;
          currentUser = null;
          document.getElementById("main-dashboard").style.display = "none";
          document.getElementById("login-section").style.display = "flex";

          window.GVET.notifications.show("Logged out successfully", "info");
        }
      }

      function initWebSocket() {
        try {
          socket = io(window.location.origin);

          socket.on("connect", () => {
            console.log("‚úÖ WebSocket connected");
            socket.emit("join-room", "dashboard");
          });

          socket.on("disconnect", () => {
            console.log("‚ùå WebSocket disconnected");
          });

          // Asset events
          socket.on("asset:created", (asset) => {
            window.GVET.notifications.show(
              `New asset created: ${asset.assetName}`,
              "success",
            );
            loadDashboardData();
          });

          socket.on("asset:updated", (asset) => {
            loadDashboardData();
          });

          // Inventory events
          socket.on("inventory:lowStock", (item) => {
            window.GVET.notifications.show(
              `Low stock alert: ${item.itemName}`,
              "warning",
              5000,
            );
            loadDashboardData();
          });

          socket.on("inventory:created", (item) => {
            window.GVET.notifications.show(
              `New inventory item: ${item.itemName}`,
              "success",
            );
            loadDashboardData();
          });

          // Livestock events
          socket.on("livestock:healthAlert", (animal) => {
            window.GVET.notifications.show(
              `Health alert: ${animal.name} - ${animal.healthStatus}`,
              "warning",
              5000,
            );
          });

          socket.on("livestock:created", (animal) => {
            window.GVET.notifications.show(
              `New animal registered: ${animal.name}`,
              "success",
            );
            loadDashboardData();
          });
        } catch (error) {
          console.warn("WebSocket initialization failed:", error);
        }
      }

      async function loadDashboardData() {
        try {
          // Use premium.js analytics
          await window.GVET.analytics.fetchStats();
          window.GVET.analytics.updateDisplay();

          // Load recent activities from audit logs
          await loadRecentActivities();
        } catch (error) {
          console.error("Error loading dashboard data:", error);
          // Fallback to demo data
          animateCounter("total-assets", 1247);
          animateCounter("total-inventory", 3456);
          animateCounter("low-stock", 12);
          animateCounter("active-users", 18);
        }
      }

      function animateCounter(id, target) {
        const element = document.getElementById(id);
        if (!element) return;

        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            element.textContent = target.toLocaleString();
            clearInterval(timer);
          } else {
            element.textContent = Math.floor(current).toLocaleString();
          }
        }, 30);
      }

      async function loadRecentActivities() {
        try {
          const token = localStorage.getItem("accessToken");
          if (!token) throw new Error("No token");

          const response = await fetch(
            `${window.GVET.config.apiBaseURL}/audit?limit=5`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            },
          );

          if (response.ok) {
            const data = await response.json();
            const container = document.getElementById("recent-activities");

            if (data.logs && data.logs.length > 0) {
              container.innerHTML = data.logs
                .map((log) => {
                  const icon = getActivityIcon(log.action);
                  const color = getActivityColor(log.status);
                  const timeAgo = getTimeAgo(log.createdAt);

                  return `
                                <div class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all">
                                    <i class="fas ${icon} ${color} mr-3 text-lg"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-800">${log.message}</p>
                                        <p class="text-xs text-gray-500">${log.username} ‚Ä¢ ${timeAgo}</p>
                                    </div>
                                </div>
                            `;
                })
                .join("");
              return;
            }
          }
        } catch (error) {
          console.warn("Failed to load activities from API:", error);
        }

        // Fallback to demo activities
        const activities = [
          {
            icon: "fa-plus-circle",
            text: "New asset registered: Dell Laptop #A1234",
            time: "2 min ago",
            color: "text-green-600",
          },
          {
            icon: "fa-edit",
            text: "Inventory updated: Office supplies",
            time: "15 min ago",
            color: "text-blue-600",
          },
          {
            icon: "fa-exclamation-triangle",
            text: "Low stock alert: Printer paper",
            time: "1 hour ago",
            color: "text-yellow-600",
          },
          {
            icon: "fa-check-circle",
            text: "Asset inspection completed",
            time: "2 hours ago",
            color: "text-green-600",
          },
          {
            icon: "fa-user-plus",
            text: "New user registered",
            time: "3 hours ago",
            color: "text-purple-600",
          },
        ];

        const container = document.getElementById("recent-activities");
        container.innerHTML = activities
          .map(
            (activity) => `
                <div class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all">
                    <i class="fas ${activity.icon} ${activity.color} mr-3 text-lg"></i>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800">${activity.text}</p>
                        <p class="text-xs text-gray-500">${activity.time}</p>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      function getActivityIcon(action) {
        const icons = {
          create: "fa-plus-circle",
          update: "fa-edit",
          delete: "fa-trash",
          login: "fa-sign-in-alt",
          logout: "fa-sign-out-alt",
          register: "fa-user-plus",
        };
        return icons[action] || "fa-info-circle";
      }

      function getActivityColor(status) {
        const colors = {
          success: "text-green-600",
          failure: "text-red-600",
          warning: "text-yellow-600",
        };
        return colors[status] || "text-blue-600";
      }

      function getTimeAgo(dateString) {
        const date = new Date(dateString);
        const seconds = Math.floor((new Date() - date) / 1000);

        if (seconds < 60) return "just now";
        if (seconds < 3600) return Math.floor(seconds / 60) + " min ago";
        if (seconds < 86400) return Math.floor(seconds / 3600) + " hours ago";
        return Math.floor(seconds / 86400) + " days ago";
      }

      // Check for existing session on page load
      async function checkExistingSession() {
        const token = localStorage.getItem("accessToken");
        const savedUser = localStorage.getItem("currentUser");

        if (token && savedUser) {
          try {
            // Verify token is still valid
            const response = await fetch(
              `${window.GVET.config.apiBaseURL}/auth/me`,
              {
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              },
            );

            if (response.ok) {
              const data = await response.json();
              currentUser = data.user;
              isLoggedIn = true;

              document.getElementById("security-modal").style.display = "none";
              document.getElementById("login-section").style.display = "none";
              document.getElementById("main-dashboard").style.display = "block";
              document.getElementById("user-role").textContent =
                currentUser.fullName || currentUser.role;

              const themeIcon = document.getElementById("theme-icon");
              if (themeIcon && isDarkMode) {
                themeIcon.className = "fas fa-sun";
              }

              initWebSocket();
              await loadDashboardData();

              console.log("‚úÖ Session restored");
              return true;
            }
          } catch (error) {
            console.warn("Session validation failed:", error);
            localStorage.removeItem("accessToken");
            localStorage.removeItem("refreshToken");
            localStorage.removeItem("currentUser");
          }
        }
        return false;
      }

      document.addEventListener("DOMContentLoaded", async function () {
        console.log("üèõÔ∏è G-VET Premium Dashboard System Initialized");

        // Check for existing session
        const sessionRestored = await checkExistingSession();

        if (!sessionRestored) {
          // Show login normally
          document
            .getElementById("login-form")
            .addEventListener("submit", async function (e) {
              e.preventDefault();
              hideLoginError();
              const username = document
                .getElementById("username")
                .value.toLowerCase()
                .trim();
              const password = document.getElementById("password").value;

              const loginBtn = e.target.querySelector('button[type="submit"]');
              const originalText = loginBtn.innerHTML;
              loginBtn.disabled = true;
              loginBtn.innerHTML =
                '<i class="fas fa-spinner fa-spin mr-2"></i>Logging in...';

              const success = await login(username, password);

              if (!success) {
                showLoginError(
                  "Invalid username or password. Please verify your credentials.",
                );
                loginBtn.disabled = false;
                loginBtn.innerHTML = originalText;
              }
            });
        }

        // Global keyboard shortcuts
        document.addEventListener("keydown", function (e) {
          if ((e.ctrlKey || e.metaKey) && e.key === "k") {
            e.preventDefault();
            window.GVET.notifications.show(
              "Global search (Ctrl+K) - Feature coming soon!",
              "info",
            );
          }
        });
      });

      async function verifySystem() {
        try {
          const token = localStorage.getItem("accessToken");
          const headers = token ? { Authorization: `Bearer ${token}` } : {};

          const response = await fetch(
            `${window.GVET.config.apiBaseURL.replace("/v1", "")}/health`,
            {
              headers,
            },
          );

          if (response.ok) {
            const data = await response.json();
            alert(
              `System Verification Report\n\n‚úÖ Status: ${data.status}\n‚úÖ Database: ${data.database}\n‚úÖ Environment: ${data.environment}\n‚úÖ Version: ${data.version}\n‚úÖ Uptime: ${Math.floor(data.uptime / 60)} minutes\n\nüèõÔ∏è All systems operational`,
            );
          } else {
            alert(
              "System verification in progress...\n\n‚úÖ All systems operational\n‚úÖ KEW.PA compliance: Active\n‚úÖ KEW.PS compliance: Active\n‚úÖ Database: Connected (Demo Mode)",
            );
          }
        } catch (error) {
          console.error("System verification error:", error);
          alert(
            "System verification in progress...\n\n‚úÖ All systems operational\n‚úÖ KEW.PA compliance: Active\n‚úÖ KEW.PS compliance: Active\n‚úÖ Database: Connected (Demo Mode)",
          );
        }
      }

      window.openModule = function (moduleName) {
        console.log(`üîÑ Opening module: ${moduleName}`);
        const moduleUrls = {
          // KEW.PA Asset Management
          "kewpa-dashboard": "/kewpa",
          "asset-registration": "/asset-registration",
          "asset-receipt": "/asset-receipt",
          "asset-movement": "/asset-movement",
          "asset-inspection": "/asset-inspection",
          "asset-maintenance": "/asset-maintenance",
          "asset-verification": "/asset-verification",

          // KEW.PS Store Management
          "kewps-dashboard": "/kewps",
          "store-receipt": "/store-receipt",
          "stock-control": "/stock-control",
          "store-issuance": "/store-issuance",
          "store-verification": "/store-verification",
          "inventory-management": "/inventory",

          // KEW.AH Live Assets
          "kewah-dashboard": "/kewah",
          "livestock-register": "/livestock-register",
          "veterinary-care": "/veterinary-care",

          // Analytics & Reports
          analytics: "/reports",
          "advanced-search": "/advanced-search",

          // Tools & Integration
          qrcode: "/qr-scanner",
          forms: "/forms",
          procurement: "/procurement",
          suppliers: "/suppliers",

          // Administration
          admin: "/admin",
          "it-admin": "/it-admin",

          // Legacy Support
          assets: "/asset-registration",
          inventory: "/inventory",
        };

        if (moduleUrls[moduleName]) {
          const url = moduleUrls[moduleName];
          console.log(`üìç Navigating to: ${url}`);

          // Show loading notification
          const notification = document.createElement("div");
          notification.className =
            "fixed top-20 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in";
          notification.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i>Loading ${moduleName}...`;
          document.body.appendChild(notification);

          setTimeout(() => {
            notification.remove();
            window.location.href = url;
          }, 800);
        } else {
          window.GVET.notifications.show(
            `Module "${moduleName}" is under development`,
            "info",
          );
        }
      };
    </script>
  </body>
</html>
